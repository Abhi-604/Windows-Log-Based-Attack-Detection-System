{"event": "See below some functions declarations for Visual Basic."}
{"event": "Frequently Asked Question:"}
{"event": "Q: Each time I use the compress function I get the -5 error (not enough"}
{"event": "room in the output buffer)."}
{"event": "A: Make sure that the length of the compressed buffer is passed by"}
{"event": "reference (\"as any\"), not by value (\"as long\"). Also check that"}
{"event": "before the call of compress this length is equal to the total size of"}
{"event": "the compressed buffer and not zero."}
{"event": "From: \"Jon Caruana\" <jon-net@usa.net>"}
{"event": "Subject: Re: How to port zlib declares to vb?"}
{"event": "Date: Mon, 28 Oct 1996 18:33:03 -0600"}
{"event": "Got the answer! (I haven't had time to check this but it's what I got, and"}
{"event": "looks correct):"}
{"event": "He has the following routines working:"}
{"event": "compress"}
{"event": "uncompress"}
{"event": "gzopen"}
{"event": "gzwrite"}
{"event": "gzread"}
{"event": "gzclose"}
{"event": "Declares follow: (Quoted from Carlos Rios <c_rios@sonda.cl>, in Vb4 form)"}
{"event": "#If Win16 Then   'Use Win16 calls."}
{"event": "Declare Function compress Lib \"ZLIB.DLL\" (ByVal compr As"}
{"event": "String, comprLen As Any, ByVal buf As String, ByVal buflen"}
{"event": "As Long) As Integer"}
{"event": "Declare Function uncompress Lib \"ZLIB.DLL\" (ByVal uncompr"}
{"event": "As String, uncomprLen As Any, ByVal compr As String, ByVal"}
{"event": "lcompr As Long) As Integer"}
{"event": "Declare Function gzopen Lib \"ZLIB.DLL\" (ByVal filePath As"}
{"event": "String, ByVal mode As String) As Long"}
{"event": "Declare Function gzread Lib \"ZLIB.DLL\" (ByVal file As"}
{"event": "Long, ByVal uncompr As String, ByVal uncomprLen As Integer)"}
{"event": "As Integer"}
{"event": "Declare Function gzwrite Lib \"ZLIB.DLL\" (ByVal file As"}
{"event": "Long, ByVal uncompr As String, ByVal uncomprLen As Integer)"}
{"event": "As Integer"}
{"event": "Declare Function gzclose Lib \"ZLIB.DLL\" (ByVal file As"}
{"event": "Long) As Integer"}
{"event": "#Else"}
{"event": "Declare Function compress Lib \"ZLIB32.DLL\""}
{"event": "(ByVal compr As String, comprLen As Any, ByVal buf As"}
{"event": "String, ByVal buflen As Long) As Integer"}
{"event": "Declare Function uncompress Lib \"ZLIB32.DLL\""}
{"event": "(ByVal uncompr As String, uncomprLen As Any, ByVal compr As"}
{"event": "String, ByVal lcompr As Long) As Long"}
{"event": "Declare Function gzopen Lib \"ZLIB32.DLL\""}
{"event": "(ByVal file As String, ByVal mode As String) As Long"}
{"event": "Declare Function gzread Lib \"ZLIB32.DLL\""}
{"event": "(ByVal file As Long, ByVal uncompr As String, ByVal"}
{"event": "uncomprLen As Long) As Long"}
{"event": "Declare Function gzwrite Lib \"ZLIB32.DLL\""}
{"event": "(ByVal file As Long, ByVal uncompr As String, ByVal"}
{"event": "uncomprLen As Long) As Long"}
{"event": "Declare Function gzclose Lib \"ZLIB32.DLL\""}
{"event": "(ByVal file As Long) As Long"}
{"event": "#End If"}
{"event": "-Jon Caruana"}
{"event": "jon-net@usa.net"}
{"event": "Microsoft Sitebuilder Network Level 1 Member - HTML Writer's Guild Member"}
{"event": "Here is another example from Michael <michael_borgsys@hotmail.com> that he"}
{"event": "says conforms to the VB guidelines, and that solves the problem of not"}
{"event": "knowing the uncompressed size by storing it at the end of the file:"}
{"event": "'Calling the functions:"}
{"event": "'bracket meaning: <parameter> [optional] {Range of possible values}"}
{"event": "'Call subCompressFile(<path with filename to compress> [, <path with"}
{"event": "filename to write to>, [level of compression {1..9}]])"}
{"event": "'Call subUncompressFile(<path with filename to compress>)"}
{"event": "Option Explicit"}
{"event": "Private lngpvtPcnSml As Long 'Stores value for 'lngPercentSmaller'"}
{"event": "Private Const SUCCESS As Long = 0"}
{"event": "Private Const strFilExt As String = \".cpr\""}
{"event": "Private Declare Function lngfncCpr Lib \"zlib.dll\" Alias \"compress2\" (ByRef"}
{"event": "dest As Any, ByRef destLen As Any, ByRef src As Any, ByVal srcLen As Long,"}
{"event": "ByVal level As Integer) As Long"}
{"event": "Private Declare Function lngfncUcp Lib \"zlib.dll\" Alias \"uncompress\" (ByRef"}
{"event": "dest As Any, ByRef destLen As Any, ByRef src As Any, ByVal srcLen As Long)"}
{"event": "As Long"}
{"event": "Public Sub subCompressFile(ByVal strargOriFilPth As String, Optional ByVal"}
{"event": "strargCprFilPth As String, Optional ByVal intLvl As Integer = 9)"}
{"event": "Dim strCprPth As String"}
{"event": "Dim lngOriSiz As Long"}
{"event": "Dim lngCprSiz As Long"}
{"event": "Dim bytaryOri() As Byte"}
{"event": "Dim bytaryCpr() As Byte"}
{"event": "lngOriSiz = FileLen(strargOriFilPth)"}
{"event": "ReDim bytaryOri(lngOriSiz - 1)"}
{"event": "Open strargOriFilPth For Binary Access Read As #1"}
{"event": "Get #1, , bytaryOri()"}
{"event": "Close #1"}
{"event": "strCprPth = IIf(strargCprFilPth = \"\", strargOriFilPth, strargCprFilPth)"}
{"event": "'Select file path and name"}
{"event": "strCprPth = strCprPth & IIf(Right(strCprPth, Len(strFilExt)) ="}
{"event": "strFilExt, \"\", strFilExt) 'Add file extension if not exists"}
{"event": "lngCprSiz = (lngOriSiz * 1.01) + 12 'Compression needs temporary a bit"}
{"event": "more space then original file size"}
{"event": "ReDim bytaryCpr(lngCprSiz - 1)"}
{"event": "If lngfncCpr(bytaryCpr(0), lngCprSiz, bytaryOri(0), lngOriSiz, intLvl) ="}
{"event": "SUCCESS Then"}
{"event": "lngpvtPcnSml = (1# - (lngCprSiz / lngOriSiz)) * 100"}
{"event": "ReDim Preserve bytaryCpr(lngCprSiz - 1)"}
{"event": "Open strCprPth For Binary Access Write As #1"}
{"event": "Put #1, , bytaryCpr()"}
{"event": "Put #1, , lngOriSiz 'Add the the original size value to the end"}
{"event": "(last 4 bytes)"}
{"event": "Close #1"}
{"event": "Else"}
{"event": "MsgBox \"Compression error\""}
{"event": "End If"}
{"event": "Erase bytaryCpr"}
{"event": "Erase bytaryOri"}
{"event": "End Sub"}
{"event": "Public Sub subUncompressFile(ByVal strargFilPth As String)"}
{"event": "Dim bytaryCpr() As Byte"}
{"event": "Dim bytaryOri() As Byte"}
{"event": "Dim lngOriSiz As Long"}
{"event": "Dim lngCprSiz As Long"}
{"event": "Dim strOriPth As String"}
{"event": "lngCprSiz = FileLen(strargFilPth)"}
{"event": "ReDim bytaryCpr(lngCprSiz - 1)"}
{"event": "Open strargFilPth For Binary Access Read As #1"}
{"event": "Get #1, , bytaryCpr()"}
{"event": "Close #1"}
{"event": "'Read the original file size value:"}
{"event": "lngOriSiz = bytaryCpr(lngCprSiz - 1) * (2 ^ 24) _"}
{"event": "+ bytaryCpr(lngCprSiz - 2) * (2 ^ 16) _"}
{"event": "+ bytaryCpr(lngCprSiz - 3) * (2 ^ 8) _"}
{"event": "+ bytaryCpr(lngCprSiz - 4)"}
{"event": "ReDim Preserve bytaryCpr(lngCprSiz - 5) 'Cut of the original size value"}
{"event": "ReDim bytaryOri(lngOriSiz - 1)"}
{"event": "If lngfncUcp(bytaryOri(0), lngOriSiz, bytaryCpr(0), lngCprSiz) = SUCCESS"}
{"event": "Then"}
{"event": "strOriPth = Left(strargFilPth, Len(strargFilPth) - Len(strFilExt))"}
{"event": "Open strOriPth For Binary Access Write As #1"}
{"event": "Put #1, , bytaryOri()"}
{"event": "Close #1"}
{"event": "Else"}
{"event": "MsgBox \"Uncompression error\""}
{"event": "End If"}
{"event": "Erase bytaryCpr"}
{"event": "Erase bytaryOri"}
{"event": "End Sub"}
{"event": "Public Property Get lngPercentSmaller() As Long"}
{"event": "lngPercentSmaller = lngpvtPcnSml"}
{"event": "End Property"}
