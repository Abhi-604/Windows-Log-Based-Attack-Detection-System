{"event": "Frequently Asked Questions about ZLIB1.DLL"}
{"event": "This document describes the design, the rationale, and the usage"}
{"event": "of the official DLL build of zlib, named ZLIB1.DLL.  If you have"}
{"event": "general questions about zlib, you should see the file \"FAQ\" found"}
{"event": "in the zlib distribution, or at the following location:"}
{"event": "http://www.gzip.org/zlib/zlib_faq.html"}
{"event": "1. What is ZLIB1.DLL, and how can I get it?"}
{"event": "- ZLIB1.DLL is the official build of zlib as a DLL."}
{"event": "(Please remark the character '1' in the name.)"}
{"event": "Pointers to a precompiled ZLIB1.DLL can be found in the zlib"}
{"event": "web site at:"}
{"event": "http://www.zlib.net/"}
{"event": "Applications that link to ZLIB1.DLL can rely on the following"}
{"event": "specification:"}
{"event": "* The exported symbols are exclusively defined in the source"}
{"event": "files \"zlib.h\" and \"zlib.def\", found in an official zlib"}
{"event": "source distribution."}
{"event": "* The symbols are exported by name, not by ordinal."}
{"event": "* The exported names are undecorated."}
{"event": "* The calling convention of functions is \"C\" (CDECL)."}
{"event": "* The ZLIB1.DLL binary is linked to MSVCRT.DLL."}
{"event": "The archive in which ZLIB1.DLL is bundled contains compiled"}
{"event": "test programs that must run with a valid build of ZLIB1.DLL."}
{"event": "It is recommended to download the prebuilt DLL from the zlib"}
{"event": "web site, instead of building it yourself, to avoid potential"}
{"event": "incompatibilities that could be introduced by your compiler"}
{"event": "and build settings.  If you do build the DLL yourself, please"}
{"event": "make sure that it complies with all the above requirements,"}
{"event": "and it runs with the precompiled test programs, bundled with"}
{"event": "the original ZLIB1.DLL distribution."}
{"event": "If, for any reason, you need to build an incompatible DLL,"}
{"event": "please use a different file name."}
{"event": "2. Why did you change the name of the DLL to ZLIB1.DLL?"}
{"event": "What happened to the old ZLIB.DLL?"}
{"event": "- The old ZLIB.DLL, built from zlib-1.1.4 or earlier, required"}
{"event": "compilation settings that were incompatible to those used by"}
{"event": "a static build.  The DLL settings were supposed to be enabled"}
{"event": "by defining the macro ZLIB_DLL, before including \"zlib.h\"."}
{"event": "Incorrect handling of this macro was silently accepted at"}
{"event": "build time, resulting in two major problems:"}
{"event": "* ZLIB_DLL was missing from the old makefile.  When building"}
{"event": "the DLL, not all people added it to the build options.  In"}
{"event": "consequence, incompatible incarnations of ZLIB.DLL started"}
{"event": "to circulate around the net."}
{"event": "* When switching from using the static library to using the"}
{"event": "DLL, applications had to define the ZLIB_DLL macro and"}
{"event": "to recompile all the sources that contained calls to zlib"}
{"event": "functions.  Failure to do so resulted in creating binaries"}
{"event": "that were unable to run with the official ZLIB.DLL build."}
{"event": "The only possible solution that we could foresee was to make"}
{"event": "a binary-incompatible change in the DLL interface, in order to"}
{"event": "remove the dependency on the ZLIB_DLL macro, and to release"}
{"event": "the new DLL under a different name."}
{"event": "We chose the name ZLIB1.DLL, where '1' indicates the major"}
{"event": "zlib version number.  We hope that we will not have to break"}
{"event": "the binary compatibility again, at least not as long as the"}
{"event": "zlib-1.x series will last."}
{"event": "There is still a ZLIB_DLL macro, that can trigger a more"}
{"event": "efficient build and use of the DLL, but compatibility no"}
{"event": "longer dependents on it."}
{"event": "3. Can I build ZLIB.DLL from the new zlib sources, and replace"}
{"event": "an old ZLIB.DLL, that was built from zlib-1.1.4 or earlier?"}
{"event": "- In principle, you can do it by assigning calling convention"}
{"event": "keywords to the macros ZEXPORT and ZEXPORTVA.  In practice,"}
{"event": "it depends on what you mean by \"an old ZLIB.DLL\", because the"}
{"event": "old DLL exists in several mutually-incompatible versions."}
{"event": "You have to find out first what kind of calling convention is"}
{"event": "being used in your particular ZLIB.DLL build, and to use the"}
{"event": "same one in the new build.  If you don't know what this is all"}
{"event": "about, you might be better off if you would just leave the old"}
{"event": "DLL intact."}
{"event": "4. Can I compile my application using the new zlib interface, and"}
{"event": "link it to an old ZLIB.DLL, that was built from zlib-1.1.4 or"}
{"event": "earlier?"}
{"event": "- The official answer is \"no\"; the real answer depends again on"}
{"event": "what kind of ZLIB.DLL you have.  Even if you are lucky, this"}
{"event": "course of action is unreliable."}
{"event": "If you rebuild your application and you intend to use a newer"}
{"event": "version of zlib (post- 1.1.4), it is strongly recommended to"}
{"event": "link it to the new ZLIB1.DLL."}
{"event": "5. Why are the zlib symbols exported by name, and not by ordinal?"}
{"event": "- Although exporting symbols by ordinal is a little faster, it"}
{"event": "is risky.  Any single glitch in the maintenance or use of the"}
{"event": "DEF file that contains the ordinals can result in incompatible"}
{"event": "builds and frustrating crashes.  Simply put, the benefits of"}
{"event": "exporting symbols by ordinal do not justify the risks."}
{"event": "Technically, it should be possible to maintain ordinals in"}
{"event": "the DEF file, and still export the symbols by name.  Ordinals"}
{"event": "exist in every DLL, and even if the dynamic linking performed"}
{"event": "at the DLL startup is searching for names, ordinals serve as"}
{"event": "hints, for a faster name lookup.  However, if the DEF file"}
{"event": "contains ordinals, the Microsoft linker automatically builds"}
{"event": "an implib that will cause the executables linked to it to use"}
{"event": "those ordinals, and not the names.  It is interesting to"}
{"event": "notice that the GNU linker for Win32 does not suffer from this"}
{"event": "problem."}
{"event": "It is possible to avoid the DEF file if the exported symbols"}
{"event": "are accompanied by a \"__declspec(dllexport)\" attribute in the"}
{"event": "source files.  You can do this in zlib by predefining the"}
{"event": "ZLIB_DLL macro."}
{"event": "6. I see that the ZLIB1.DLL functions use the \"C\" (CDECL) calling"}
{"event": "convention.  Why not use the STDCALL convention?"}
{"event": "STDCALL is the standard convention in Win32, and I need it in"}
{"event": "my Visual Basic project!"}
{"event": "(For readability, we use CDECL to refer to the convention"}
{"event": "triggered by the \"__cdecl\" keyword, STDCALL to refer to"}
{"event": "the convention triggered by \"__stdcall\", and FASTCALL to"}
{"event": "refer to the convention triggered by \"__fastcall\".)"}
{"event": "- Most of the native Windows API functions (without varargs) use"}
{"event": "indeed the WINAPI convention (which translates to STDCALL in"}
{"event": "Win32), but the standard C functions use CDECL.  If a user"}
{"event": "application is intrinsically tied to the Windows API (e.g."}
{"event": "it calls native Windows API functions such as CreateFile()),"}
{"event": "sometimes it makes sense to decorate its own functions with"}
{"event": "WINAPI.  But if ANSI C or POSIX portability is a goal (e.g."}
{"event": "it calls standard C functions such as fopen()), it is not a"}
{"event": "sound decision to request the inclusion of <windows.h>, or to"}
{"event": "use non-ANSI constructs, for the sole purpose to make the user"}
{"event": "functions STDCALL-able."}
{"event": "The functionality offered by zlib is not in the category of"}
{"event": "\"Windows functionality\", but is more like \"C functionality\"."}
{"event": "Technically, STDCALL is not bad; in fact, it is slightly"}
{"event": "faster than CDECL, and it works with variable-argument"}
{"event": "functions, just like CDECL.  It is unfortunate that, in spite"}
{"event": "of using STDCALL in the Windows API, it is not the default"}
{"event": "convention used by the C compilers that run under Windows."}
{"event": "The roots of the problem reside deep inside the unsafety of"}
{"event": "the K&R-style function prototypes, where the argument types"}
{"event": "are not specified; but that is another story for another day."}
{"event": "The remaining fact is that CDECL is the default convention."}
{"event": "Even if an explicit convention is hard-coded into the function"}
{"event": "prototypes inside C headers, problems may appear.  The"}
{"event": "necessity to expose the convention in users' callbacks is one"}
{"event": "of these problems."}
{"event": "The calling convention issues are also important when using"}
{"event": "zlib in other programming languages.  Some of them, like Ada"}
{"event": "(GNAT) and Fortran (GNU G77), have C bindings implemented"}
{"event": "initially on Unix, and relying on the C calling convention."}
{"event": "On the other hand, the pre- .NET versions of Microsoft Visual"}
{"event": "Basic require STDCALL, while Borland Delphi prefers, although"}
{"event": "it does not require, FASTCALL."}
{"event": "In fairness to all possible uses of zlib outside the C"}
{"event": "programming language, we choose the default \"C\" convention."}
{"event": "Anyone interested in different bindings or conventions is"}
{"event": "encouraged to maintain specialized projects.  The \"contrib/\""}
{"event": "directory from the zlib distribution already holds a couple"}
{"event": "of foreign bindings, such as Ada, C++, and Delphi."}
{"event": "7. I need a DLL for my Visual Basic project.  What can I do?"}
{"event": "- Define the ZLIB_WINAPI macro before including \"zlib.h\", when"}
{"event": "building both the DLL and the user application (except that"}
{"event": "you don't need to define anything when using the DLL in Visual"}
{"event": "Basic).  The ZLIB_WINAPI macro will switch on the WINAPI"}
{"event": "(STDCALL) convention.  The name of this DLL must be different"}
{"event": "than the official ZLIB1.DLL."}
{"event": "Gilles Vollant has contributed a build named ZLIBWAPI.DLL,"}
{"event": "with the ZLIB_WINAPI macro turned on, and with the minizip"}
{"event": "functionality built in.  For more information, please read"}
{"event": "the notes inside \"contrib/vstudio/readme.txt\", found in the"}
{"event": "zlib distribution."}
{"event": "8. I need to use zlib in my Microsoft .NET project.  What can I"}
{"event": "do?"}
{"event": "- Henrik Ravn has contributed a .NET wrapper around zlib.  Look"}
{"event": "into contrib/dotzlib/, inside the zlib distribution."}
{"event": "9. If my application uses ZLIB1.DLL, should I link it to"}
{"event": "MSVCRT.DLL?  Why?"}
{"event": "- It is not required, but it is recommended to link your"}
{"event": "application to MSVCRT.DLL, if it uses ZLIB1.DLL."}
{"event": "The executables (.EXE, .DLL, etc.) that are involved in the"}
{"event": "same process and are using the C run-time library (i.e. they"}
{"event": "are calling standard C functions), must link to the same"}
{"event": "library.  There are several libraries in the Win32 system:"}
{"event": "CRTDLL.DLL, MSVCRT.DLL, the static C libraries, etc."}
{"event": "Since ZLIB1.DLL is linked to MSVCRT.DLL, the executables that"}
{"event": "depend on it should also be linked to MSVCRT.DLL."}
{"event": "10. Why are you saying that ZLIB1.DLL and my application should"}
{"event": "be linked to the same C run-time (CRT) library?  I linked my"}
{"event": "application and my DLLs to different C libraries (e.g. my"}
{"event": "application to a static library, and my DLLs to MSVCRT.DLL),"}
{"event": "and everything works fine."}
{"event": "- If a user library invokes only pure Win32 API (accessible via"}
{"event": "<windows.h> and the related headers), its DLL build will work"}
{"event": "in any context.  But if this library invokes standard C API,"}
{"event": "things get more complicated."}
{"event": "There is a single Win32 library in a Win32 system.  Every"}
{"event": "function in this library resides in a single DLL module, that"}
{"event": "is safe to call from anywhere.  On the other hand, there are"}
{"event": "multiple versions of the C library, and each of them has its"}
{"event": "own separate internal state.  Standalone executables and user"}
{"event": "DLLs that call standard C functions must link to a C run-time"}
{"event": "(CRT) library, be it static or shared (DLL).  Intermixing"}
{"event": "occurs when an executable (not necessarily standalone) and a"}
{"event": "DLL are linked to different CRTs, and both are running in the"}
{"event": "same process."}
{"event": "Intermixing multiple CRTs is possible, as long as their"}
{"event": "internal states are kept intact.  The Microsoft Knowledge Base"}
{"event": "articles KB94248 \"HOWTO: Use the C Run-Time\" and KB140584"}
{"event": "\"HOWTO: Link with the Correct C Run-Time (CRT) Library\""}
{"event": "mention the potential problems raised by intermixing."}
{"event": "If intermixing works for you, it's because your application"}
{"event": "and DLLs are avoiding the corruption of each of the CRTs'"}
{"event": "internal states, maybe by careful design, or maybe by fortune."}
{"event": "Also note that linking ZLIB1.DLL to non-Microsoft CRTs, such"}
{"event": "as those provided by Borland, raises similar problems."}
{"event": "11. Why are you linking ZLIB1.DLL to MSVCRT.DLL?"}
{"event": "- MSVCRT.DLL exists on every Windows 95 with a new service pack"}
{"event": "installed, or with Microsoft Internet Explorer 4 or later, and"}
{"event": "on all other Windows 4.x or later (Windows 98, Windows NT 4,"}
{"event": "or later).  It is freely distributable; if not present in the"}
{"event": "system, it can be downloaded from Microsoft or from other"}
{"event": "software provider for free."}
{"event": "The fact that MSVCRT.DLL does not exist on a virgin Windows 95"}
{"event": "is not so problematic.  Windows 95 is scarcely found nowadays,"}
{"event": "Microsoft ended its support a long time ago, and many recent"}
{"event": "applications from various vendors, including Microsoft, do not"}
{"event": "even run on it.  Furthermore, no serious user should run"}
{"event": "Windows 95 without a proper update installed."}
{"event": "12. Why are you not linking ZLIB1.DLL to"}
{"event": "<<my favorite C run-time library>> ?"}
{"event": "- We considered and abandoned the following alternatives:"}
{"event": "* Linking ZLIB1.DLL to a static C library (LIBC.LIB, or"}
{"event": "LIBCMT.LIB) is not a good option.  People are using the DLL"}
{"event": "mainly to save disk space.  If you are linking your program"}
{"event": "to a static C library, you may as well consider linking zlib"}
{"event": "in statically, too."}
{"event": "* Linking ZLIB1.DLL to CRTDLL.DLL looks appealing, because"}
{"event": "CRTDLL.DLL is present on every Win32 installation."}
{"event": "Unfortunately, it has a series of problems: it does not"}
{"event": "work properly with Microsoft's C++ libraries, it does not"}
{"event": "provide support for 64-bit file offsets, (and so on...),"}
{"event": "and Microsoft discontinued its support a long time ago."}
{"event": "* Linking ZLIB1.DLL to MSVCR70.DLL or MSVCR71.DLL, supplied"}
{"event": "with the Microsoft .NET platform, and Visual C++ 7.0/7.1,"}
{"event": "raises problems related to the status of ZLIB1.DLL as a"}
{"event": "system component.  According to the Microsoft Knowledge Base"}
{"event": "article KB326922 \"INFO: Redistribution of the Shared C"}
{"event": "Runtime Component in Visual C++ .NET\", MSVCR70.DLL and"}
{"event": "MSVCR71.DLL are not supposed to function as system DLLs,"}
{"event": "because they may clash with MSVCRT.DLL.  Instead, the"}
{"event": "application's installer is supposed to put these DLLs"}
{"event": "(if needed) in the application's private directory."}
{"event": "If ZLIB1.DLL depends on a non-system runtime, it cannot"}
{"event": "function as a redistributable system component."}
{"event": "* Linking ZLIB1.DLL to non-Microsoft runtimes, such as"}
{"event": "Borland's, or Cygwin's, raises problems related to the"}
{"event": "reliable presence of these runtimes on Win32 systems."}
{"event": "It's easier to let the DLL build of zlib up to the people"}
{"event": "who distribute these runtimes, and who may proceed as"}
{"event": "explained in the answer to Question 14."}
{"event": "13. If ZLIB1.DLL cannot be linked to MSVCR70.DLL or MSVCR71.DLL,"}
{"event": "how can I build/use ZLIB1.DLL in Microsoft Visual C++ 7.0"}
{"event": "(Visual Studio .NET) or newer?"}
{"event": "- Due to the problems explained in the Microsoft Knowledge Base"}
{"event": "article KB326922 (see the previous answer), the C runtime that"}
{"event": "comes with the VC7 environment is no longer considered a"}
{"event": "system component.  That is, it should not be assumed that this"}
{"event": "runtime exists, or may be installed in a system directory."}
{"event": "Since ZLIB1.DLL is supposed to be a system component, it may"}
{"event": "not depend on a non-system component."}
{"event": "In order to link ZLIB1.DLL and your application to MSVCRT.DLL"}
{"event": "in VC7, you need the library of Visual C++ 6.0 or older.  If"}
{"event": "you don't have this library at hand, it's probably best not to"}
{"event": "use ZLIB1.DLL."}
{"event": "We are hoping that, in the future, Microsoft will provide a"}
{"event": "way to build applications linked to a proper system runtime,"}
{"event": "from the Visual C++ environment.  Until then, you have a"}
{"event": "couple of alternatives, such as linking zlib in statically."}
{"event": "If your application requires dynamic linking, you may proceed"}
{"event": "as explained in the answer to Question 14."}
{"event": "14. I need to link my own DLL build to a CRT different than"}
{"event": "MSVCRT.DLL.  What can I do?"}
{"event": "- Feel free to rebuild the DLL from the zlib sources, and link"}
{"event": "it the way you want.  You should, however, clearly state that"}
{"event": "your build is unofficial.  You should give it a different file"}
{"event": "name, and/or install it in a private directory that can be"}
{"event": "accessed by your application only, and is not visible to the"}
{"event": "others (i.e. it's neither in the PATH, nor in the SYSTEM or"}
{"event": "SYSTEM32 directories).  Otherwise, your build may clash with"}
{"event": "applications that link to the official build."}
{"event": "For example, in Cygwin, zlib is linked to the Cygwin runtime"}
{"event": "CYGWIN1.DLL, and it is distributed under the name CYGZ.DLL."}
{"event": "15. May I include additional pieces of code that I find useful,"}
{"event": "link them in ZLIB1.DLL, and export them?"}
{"event": "- No.  A legitimate build of ZLIB1.DLL must not include code"}
{"event": "that does not originate from the official zlib source code."}
{"event": "But you can make your own private DLL build, under a different"}
{"event": "file name, as suggested in the previous answer."}
{"event": "For example, zlib is a part of the VCL library, distributed"}
{"event": "with Borland Delphi and C++ Builder.  The DLL build of VCL"}
{"event": "is a redistributable file, named VCLxx.DLL."}
{"event": "16. May I remove some functionality out of ZLIB1.DLL, by enabling"}
{"event": "macros like NO_GZCOMPRESS or NO_GZIP at compile time?"}
{"event": "- No.  A legitimate build of ZLIB1.DLL must provide the complete"}
{"event": "zlib functionality, as implemented in the official zlib source"}
{"event": "code.  But you can make your own private DLL build, under a"}
{"event": "different file name, as suggested in the previous answer."}
{"event": "17. I made my own ZLIB1.DLL build.  Can I test it for compliance?"}
{"event": "- We prefer that you download the official DLL from the zlib"}
{"event": "web site.  If you need something peculiar from this DLL, you"}
{"event": "can send your suggestion to the zlib mailing list."}
{"event": "However, in case you do rebuild the DLL yourself, you can run"}
{"event": "it with the test programs found in the DLL distribution."}
{"event": "Running these test programs is not a guarantee of compliance,"}
{"event": "but a failure can imply a detected problem."}
{"event": "**"}
{"event": "This document is written and maintained by"}
{"event": "Cosmin Truta <cosmint@cs.ubbcluj.ro>"}
